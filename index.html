<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Gioco</title>
<style>
  body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    text-align: center;
  }
  #message {
    display: none;
  }
  button {
    padding: 10px 20px;
    margin-top: 10px;
    font-size: 16px;
  }

  canvas {
    display: block;
    margin: 20px auto;
    border: 2px solid #fff;
    background: #000;
  }
  #controls {
    display: grid;
    grid-template-columns: 60px 60px 60px;
    grid-template-rows: 60px 60px;
    grid-template-areas:
      ". up ."
      "left down right";
    width: 180px;
    margin: 0 auto 20px;
    gap: 5px;
  }
  #controls button {
=======

  #game-wrapper {
    position: relative;
    display: grid;
    grid-template-columns: 60px 300px 60px;
    grid-template-rows: 60px 300px 60px;
    grid-template-areas:
      ". up ."
      "left game right"
      ". down .";
    width: 420px;
    margin: 20px auto;
  }
  #game-wrapper canvas {
    grid-area: game;
    display: block;
    border: 2px solid #fff;
    background: #000;
  }
  #game-wrapper button {

    width: 60px;
    height: 60px;
    font-size: 24px;
    margin: 0;
    padding: 0;
  }
  #btn-up   { grid-area: up; }
  #btn-left { grid-area: left; }
  #btn-right{ grid-area: right; }
  #btn-down { grid-area: down; }

</style>
</head>
<body>
<canvas id="game" width="300" height="300"></canvas>
<div id="controls">
  <button id="btn-up">&#9650;</button>
  <button id="btn-left">&#9664;</button>
=======
=======
  #controls {
    margin-top: 10px;
    display: grid;
    grid-template-columns: 60px 60px 60px;
    grid-template-rows: 60px 60px 60px;
    gap: 5px;
    justify-content: center;
  }
  #controls button {
    width: 60px;
    height: 60px;
    font-size: 24px;
  }

</style>
</head>
<body>
<div id="game-wrapper">
  <button id="btn-up">&#9650;</button>
  <button id="btn-left">&#9664;</button>
  <canvas id="game" width="300" height="300"></canvas>

  <button id="btn-right">&#9654;</button>
  <button id="btn-down">&#9660;</button>
</div>
<div id="score">Score: 0</div>
<div id="message">
  <h2 id="msgText"></h2>
  <button id="restart">Restart</button>
</div>
<div id="controls">
  <button id="btn-up" style="grid-column: 2; grid-row: 1;">&#9650;</button>
  <button id="btn-left" style="grid-column: 1; grid-row: 2;">&#9664;</button>
  <button id="btn-right" style="grid-column: 3; grid-row: 2;">&#9654;</button>
  <button id="btn-down" style="grid-column: 2; grid-row: 3;">&#9660;</button>
</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const CELL = 20;
const COLS = 15;
const ROWS = 15;

let map = [];
let pacman = { x: 1, y: 1 };
let ghost = { x: COLS - 2, y: ROWS - 2 };
let score = 0;
let gameOver = false;
const GHOST_SPEED = 5;
let ghostCounter = 0;

const GHOST_SPEED = 5;
=======
const GHOST_SPEED = 10;

let ghostCounter = 0;

function initMap() {
  map = [];
  for (let y = 0; y < ROWS; y++) {
    const row = [];
    for (let x = 0; x < COLS; x++) {
      let val = 2; // dot
      if (
        x === 0 ||
        y === 0 ||
        x === COLS - 1 ||
        y === ROWS - 1 ||
        (x % 2 === 0 && y > 2 && y < ROWS - 3) ||
        (y % 2 === 0 && x > 2 && x < COLS - 3)
      ) {
        val = 1; // wall
      }
      row.push(val);
    }
    map.push(row);
  }
  map[pacman.y][pacman.x] = 0;
  map[ghost.y][ghost.x] = 0;
}

function drawCell(x, y) {
  const val = map[y][x];
  if (val === 1) {
    ctx.fillStyle = '#0033cc';
    ctx.fillRect(x * CELL, y * CELL, CELL, CELL);
  } else {
    ctx.fillStyle = '#000';
    ctx.fillRect(x * CELL, y * CELL, CELL, CELL);
    if (val === 2) {
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(x * CELL + CELL / 2, y * CELL + CELL / 2, 3, 0, Math.PI * 2);
      ctx.fill();
    }
  }
}

function draw() {
  for (let y = 0; y < ROWS; y++) {
    for (let x = 0; x < COLS; x++) {
      drawCell(x, y);
    }
  }
  ctx.fillStyle = 'yellow';
  ctx.beginPath();
  ctx.arc(pacman.x * CELL + CELL / 2, pacman.y * CELL + CELL / 2, CELL / 2 - 2, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = 'red';
  ctx.beginPath();
  ctx.arc(ghost.x * CELL + CELL / 2, ghost.y * CELL + CELL / 2, CELL / 2 - 2, 0, Math.PI * 2);
  ctx.fill();
}

function moveEntity(entity, dx, dy) {
  const nx = entity.x + dx;
  const ny = entity.y + dy;
  if (map[ny][nx] !== 1) {
    entity.x = nx;
    entity.y = ny;
  }
}

const directions = {
  ArrowLeft: [-1, 0],
  ArrowRight: [1, 0],
  ArrowUp: [0, -1],
  ArrowDown: [0, 1],
};

document.addEventListener('keydown', (e) => {
  if (gameOver) return;
  const d = directions[e.key];
  if (d) {
    moveEntity(pacman, d[0], d[1]);
    eat();
  }
});

function setupTouchControls() {
  const mapBtn = {
    'btn-left': [-1, 0],
    'btn-right': [1, 0],
    'btn-up': [0, -1],
    'btn-down': [0, 1],
  };
  for (const id in mapBtn) {
    const btn = document.getElementById(id);
    ['mousedown', 'touchstart'].forEach((ev) => {
      btn.addEventListener(ev, (e) => {
        e.preventDefault();
        if (gameOver) return;
        const d = mapBtn[id];
        moveEntity(pacman, d[0], d[1]);
        eat();
      });
    });
  }
}

function eat() {
  if (map[pacman.y][pacman.x] === 2) {
    map[pacman.y][pacman.x] = 0;
    score += 10;
    document.getElementById('score').textContent = 'Score: ' + score;
  }
}

function moveGhost() {
  const choices = [];
  if (map[ghost.y][ghost.x - 1] !== 1) choices.push([-1, 0]);
  if (map[ghost.y][ghost.x + 1] !== 1) choices.push([1, 0]);
  if (map[ghost.y - 1][ghost.x] !== 1) choices.push([0, -1]);
  if (map[ghost.y + 1][ghost.x] !== 1) choices.push([0, 1]);
  const move = choices[Math.floor(Math.random() * choices.length)];
  ghost.x += move[0];
  ghost.y += move[1];
}

function checkCollision() {
  if (ghost.x === pacman.x && ghost.y === pacman.y) {
    endGame('Sei stato preso!');
  } else if (map.every((row) => row.every((v) => v !== 2))) {
    endGame('Hai vinto!');
  }
}

function endGame(msg) {
  gameOver = true;
  document.getElementById('msgText').textContent = msg + ' Punteggio: ' + score;
  document.getElementById('message').style.display = 'block';
}

document.getElementById('restart').onclick = () => {
  location.reload();
};

function loop() {
  if (!gameOver) {
    ghostCounter++;
    if (ghostCounter % GHOST_SPEED === 0) {
      moveGhost();
    }
    checkCollision();
    draw();
    requestAnimationFrame(loop);
  }
}

initMap();
draw();
setupTouchControls();
loop();
</script>
</body>
</html>
